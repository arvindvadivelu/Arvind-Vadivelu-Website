<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #fff; font-family: sans-serif; }
        .input-field { width: 100%; background: #0F0F0F; border: 1px solid #1F1F1F; padding: 0.75rem; border-radius: 0.5rem; color: white; margin-top: 0.5rem; outline: none; }
        .input-field:focus { border-color: #FFD02F; }
    </style>
</head>
<body class="p-8 pb-32">

    <div class="max-w-4xl mx-auto">
        <div class="flex items-center gap-3 mb-8">
            <span class="w-3 h-3 rounded-full bg-[#FFD02F]"></span>
            <h1 class="text-3xl font-bold">Content Generator & Auto-Saver</h1>
        </div>

        <p class="text-gray-400 mb-8">Write your blog naturally. Click "Generate", then click "Auto-Save to articles.js" to instantly inject the post into your database.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="text-sm text-gray-400 font-bold uppercase tracking-widest">Article Title</label>
                <input type="text" id="title" class="input-field" placeholder="e.g. Scaling Node.js">
            </div>
            <div>
                <label class="text-sm text-gray-400 font-bold uppercase tracking-widest">Category</label>
                <select id="category" class="input-field">
                    <option value="Backend">Backend</option>
                    <option value="System Design">System Design</option>
                    <option value="Database">Database</option>
                    <option value="DevOps">DevOps</option>
                </select>
            </div>
            <div class="md:col-span-2">
                <label class="text-sm text-gray-400 font-bold uppercase tracking-widest">Short Description</label>
                <input type="text" id="desc" class="input-field" placeholder="A 2-line summary for the card...">
            </div>
            <div class="md:col-span-2">
                <label class="text-sm text-gray-400 font-bold uppercase tracking-widest">Cover Image</label>
                <input type="text" id="image" class="input-field" placeholder="./images/my-cover.jpg">
            </div>
            <div class="md:col-span-2">
                <label class="text-sm text-gray-400 font-bold uppercase tracking-widest mb-2 block">Content (Markdown Supported)</label>
                <textarea id="content" rows="12" class="input-field font-mono text-sm" placeholder="Write your blog post here..."></textarea>
            </div>
        </div>

        <button onclick="generateCode()" class="w-full bg-[#FFD02F] text-black font-bold py-4 rounded-xl hover:bg-yellow-500 transition-colors mb-8">
            1. Generate Code Snippet
        </button>

        <div id="output-area" class="hidden">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between mb-4 border-t border-[#1F1F1F] pt-8">
                <h2 class="text-xl font-bold text-green-400">✅ Code Generated!</h2>
                
                <button onclick="saveToFile(event)" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg transition-colors flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                    2. Auto-Save to articles.js
                </button>
            </div>
            
            <div class="relative">
                <button onclick="copyCode(event)" class="absolute top-4 right-4 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg text-sm font-bold transition-colors">Copy Manually Instead</button>
                <pre><code id="result-code" class="block bg-[#0F0F0F] border border-[#1F1F1F] p-6 rounded-xl overflow-x-auto text-sm text-gray-300 font-mono whitespace-pre-wrap"></code></pre>
            </div>
        </div>
    </div>

    <script>
        // Custom Lightweight Markdown Parser
        function parseMarkdownToHTML(md) {
            let html = md;
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code class="language-$1">$2</code></pre>');
            html = html.replace(/\`([^`]+)\`/g, '<code>$1</code>');
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            html = html.split('\n\n').map(p => {
                const trimmed = p.trim();
                if (trimmed === '') return '';
                if (trimmed.startsWith('<pre') || trimmed.startsWith('<h3')) return trimmed;
                return '<p class="text-xl font-light text-gray-300 mb-8 leading-relaxed">' + trimmed.replace(/\n/g, '<br>') + '</p>';
            }).filter(p => p !== '').join('\n');
            return html;
        }

        function generateCode() {
            const title = document.getElementById('title').value;
            const category = document.getElementById('category').value;
            const desc = document.getElementById('desc').value;
            const image = document.getElementById('image').value || "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?q=80&w=2000&auto=format&fit=crop";
            const rawContent = document.getElementById('content').value;

            const dateOpts = { year: 'numeric', month: 'short', day: 'numeric' };
            const today = new Date().toLocaleDateString('en-US', dateOpts);
            const wordCount = rawContent.split(' ').length;
            const readTime = Math.max(1, Math.ceil(wordCount / 200)) + " min read";
            let parsedHTML = parseMarkdownToHTML(rawContent);
            const safeHTML = parsedHTML.replace(/`/g, '\\`').replace(/\$/g, '\\$');

            const finalCode = 
            "    {\n" +
            "        id: " + Date.now() + ",\n" +
            "        title: \"" + title.replace(/"/g, '\\"') + "\",\n" +
            "        category: \"" + category + "\",\n" +
            "        date: \"" + today + "\",\n" +
            "        readTime: \"" + readTime + "\",\n" +
            "        desc: \"" + desc.replace(/"/g, '\\"') + "\",\n" +
            "        image: \"" + image + "\",\n" +
            "        content: `\n" +
            "            " + safeHTML + "\n" +
            "        `\n" +
            "    },";

            document.getElementById('result-code').textContent = finalCode;
            document.getElementById('output-area').classList.remove('hidden');
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        function copyCode(event) {
            const code = document.getElementById('result-code').textContent;
            navigator.clipboard.writeText(code);
            const btn = event.target;
            btn.innerText = "Copied!";
            setTimeout(() => { btn.innerText = "Copy Manually Instead"; }, 2000);
        }

        // --- NEW AUTO-SAVE LOGIC ---
        async function saveToFile(event) {
            const btn = event.target;
            
            try {
                // 1. Ask user to pick the articles.js file
                const [fileHandle] = await window.showOpenFilePicker({
                    types: [{
                        description: 'JavaScript File',
                        accept: {'text/javascript': ['.js']},
                    }],
                });

                // 2. Read the current contents of articles.js
                const file = await fileHandle.getFile();
                let content = await file.text();

                // 3. Find the injection point (Right after "const articles = [")
                const targetText = "const articles = [";
                const insertIndex = content.indexOf(targetText);

                if (insertIndex === -1) {
                    alert("Error: Could not find 'const articles = [' in the file. Make sure you selected the correct file.");
                    return;
                }

                // 4. Inject the new code at the top of the array
                const newCode = document.getElementById('result-code').textContent;
                const splitPosition = insertIndex + targetText.length;
                
                const updatedContent = 
                    content.slice(0, splitPosition) + 
                    "\n" + newCode + 
                    content.slice(splitPosition);

                // 5. Save the file silently
                const writable = await fileHandle.createWritable();
                await writable.write(updatedContent);
                await writable.close();

                // Success UI
                btn.innerHTML = `✅ Successfully Saved!`;
                btn.classList.replace("bg-blue-600", "bg-green-600");
                btn.classList.replace("hover:bg-blue-500", "hover:bg-green-500");

                setTimeout(() => {
                    btn.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg> Auto-Save to articles.js`;
                    btn.classList.replace("bg-green-600", "bg-blue-600");
                    btn.classList.replace("hover:bg-green-500", "hover:bg-blue-500");
                    
                    // Clear the form for the next post
                    document.getElementById('title').value = '';
                    document.getElementById('desc').value = '';
                    document.getElementById('content').value = '';
                }, 3000);

            } catch (err) {
                // User cancelled the file picker or permission denied
                console.error(err);
            }
        }
    </script>
</body>
</html>